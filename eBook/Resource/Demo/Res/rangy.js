
/*
 Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/
 
 Copyright 2011, Tim Down
 Licensed under the MIT license.
 Version: 1.2
 Build date: 25 April 2011
 */
var rangy=function(){function m(o,r){var A=typeof o[r];return A=="function"||!!(A=="object"&&o[r])||A=="unknown"}function N(o,r){return!!(typeof o[r]=="object"&&o[r])}function I(o,r){return typeof o[r]!="undefined"}function E(o){return function(r,A){for(var O=A.length;O--;)if(!o(r,A[O]))return false;return true}}function y(o){window.alert("Rangy not supported in your browser. Reason: "+o);q.initialized=true;q.supported=false}function D(){if(!q.initialized){var o,r=false,A=false;if(m(document,"createRange")){o=
    document.createRange();if(x(o,k)&&s(o,Q))r=true;o.detach()}if((o=N(document,"body")?document.body:document.getElementsByTagName("body")[0])&&m(o,"createTextRange")){o=o.createTextRange();if(x(o,t)&&s(o,p))A=true}!r&&!A&&y("Neither Range nor TextRange are implemented");q.initialized=true;q.features={implementsDomRange:r,implementsTextRange:A};r=f.concat(d);A=0;for(o=r.length;A<o;++A)try{r[A](q)}catch(O){N(window,"console")&&m(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           O)}}}function J(o){this.name=o;this.supported=this.initialized=false}var Q=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],k=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],
    p=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],t=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint"],x=E(m),B=E(N),s=E(I),q={initialized:false,supported:true,util:{isHostMethod:m,isHostObject:N,isHostProperty:I,areHostMethods:x,areHostObjects:B,areHostProperties:s},features:{},modules:{},config:{alertOnWarn:false}};q.fail=y;q.warn=function(o){o="Rangy warning: "+o;if(q.config.alertOnWarn)window.alert(o);
        else typeof window.console!="undefined"&&typeof window.console.log!="undefined"&&window.console.log(o)};var d=[],f=[];q.init=D;q.addInitListener=function(o){q.initialized?o(q):d.push(o)};var j=[];q.addCreateMissingNativeApiListener=function(o){j.push(o)};q.createMissingNativeApi=function(o){o=o||window;D();for(var r=0,A=j.length;r<A;++r)j[r](o)};J.prototype.fail=function(o){this.initialized=true;this.supported=false;throw Error("Module '"+this.name+"' failed to load: "+o);};J.prototype.warn=function(o){q.warn("Module "+
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           this.name+": "+o)};J.prototype.createError=function(o){return Error("Error in Rangy "+this.name+" module: "+o)};q.createModule=function(o,r){var A=new J(o);q.modules[o]=A;f.push(function(O){r(O,A);A.initialized=true;A.supported=true})};q.requireModules=function(o){for(var r=0,A=o.length,O,R;r<A;++r){R=o[r];O=q.modules[R];if(!O||!(O instanceof J))throw Error("Module '"+R+"' not found");if(!O.supported)throw Error("Module '"+R+"' not supported");}};var u=false;B=function(){if(!u){u=true;q.initialized||
            D()}};if(typeof window=="undefined")y("No window found");else if(typeof document=="undefined")y("No document found");else{m(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",B,false);if(m(window,"addEventListener"))window.addEventListener("load",B,false);else m(window,"attachEvent")?window.attachEvent("onload",B):y("Window does not have required addEventListener or attachEvent method");return q}}();
rangy.createModule("DomUtil",function(m,N){function I(d){for(var f=0;d=d.previousSibling;)f++;return f}function E(d,f){var j=[],u;for(u=d;u;u=u.parentNode)j.push(u);for(u=f;u;u=u.parentNode)if(q(j,u))return u;return null}function y(d,f,j){for(j=j?d:d.parentNode;j;){d=j.parentNode;if(d===f)return j;j=d}return null}function D(d){d=d.nodeType;return d==3||d==4||d==8}function J(d,f){var j=f.nextSibling,u=f.parentNode;j?u.insertBefore(d,j):u.appendChild(d);return d}function Q(d){if(d.nodeType==9)return d;
                   else if(typeof d.ownerDocument!="undefined")return d.ownerDocument;else if(typeof d.document!="undefined")return d.document;else if(d.parentNode)return Q(d.parentNode);else throw Error("getDocument: no document found for node");}function k(d){if(!d)return"[No node]";return D(d)?'"'+d.data+'"':d.nodeType==1?"<"+d.nodeName+(d.id?' id="'+d.id+'"':"")+">["+d.childNodes.length+"]":d.nodeName}function p(d){this._next=this.root=d}function t(d,f){this.node=d;this.offset=f}function x(d){this.code=this[d];
                   this.codeName=d;this.message="DOMException: "+this.codeName}var B=m.util;B.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||N.fail("document missing a Node creation method");B.isHostMethod(document,"getElementsByTagName")||N.fail("document missing getElementsByTagName method");var s=document.createElement("div");B.areHostMethods(s,["insertBefore","appendChild","cloneNode"])||N.fail("Incomplete Element implementation");s=document.createTextNode("test");B.areHostMethods(s,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 ["splitText","deleteData","insertData","appendData","cloneNode"])||N.fail("Incomplete Text Node implementation");var q=function(d,f){for(var j=d.length;j--;)if(d[j]===f)return true;return false};p.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var d=this._current=this._next,f;if(this._current)if(f=d.firstChild)this._next=f;else{for(f=null;d!==this.root&&!(f=d.nextSibling);)d=d.parentNode;this._next=f}return this._current},detach:function(){this._current=this._next=
                   this.root=null}};t.prototype={equals:function(d){return this.node===d.node&this.offset==d.offset},inspect:function(){return"[DomPosition("+k(this.node)+":"+this.offset+")]"}};x.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};x.prototype.toString=function(){return this.message};m.dom={arrayContains:q,getNodeIndex:I,getCommonAncestor:E,isAncestorOf:function(d,f,j){for(f=j?f:f.parentNode;f;)if(f===
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              d)return true;else f=f.parentNode;return false},getClosestAncestorIn:y,isCharacterDataNode:D,insertAfter:J,splitDataNode:function(d,f){var j;if(d.nodeType==3)j=d.splitText(f);else{j=d.cloneNode();j.deleteData(0,f);d.deleteData(0,d.length-f);J(j,d)}return j},getDocument:Q,getWindow:function(d){d=Q(d);if(typeof d.defaultView!="undefined")return d.defaultView;else if(typeof d.parentWindow!="undefined")return d.parentWindow;else throw Error("Cannot get a window object for node");},getIframeWindow:function(d){if(typeof d.contentWindow!=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               "undefined")return d.contentWindow;else if(typeof d.contentDocument!="undefined")return d.contentDocument.defaultView;else throw Error("getIframeWindow: No Window object found for iframe element");},getIframeDocument:function(d){if(typeof d.contentDocument!="undefined")return d.contentDocument;else if(typeof d.contentWindow!="undefined")return d.contentWindow.document;else throw Error("getIframeWindow: No Document object found for iframe element");},getBody:function(d){return B.isHostObject(d,"body")?
                   d.body:d.getElementsByTagName("body")[0]},comparePoints:function(d,f,j,u){var o;if(d==j)return f===u?0:f<u?-1:1;else if(o=y(j,d,true))return f<=I(o)?-1:1;else if(o=y(d,j,true))return I(o)<u?-1:1;else{f=E(d,j);d=d===f?f:y(d,f,true);j=j===f?f:y(j,f,true);if(d===j)throw Error("comparePoints got to case 4 and childA and childB are the same!");else{for(f=f.firstChild;f;){if(f===d)return-1;else if(f===j)return 1;f=f.nextSibling}throw Error("Should not be here!");}}},inspectNode:k,createIterator:function(d){return new p(d)},
                   DomPosition:t};m.DOMException=x});
rangy.createModule("DomRange",function(m){function N(b,h){return b.nodeType!=3&&(i.isAncestorOf(b,h.startContainer,true)||i.isAncestorOf(b,h.endContainer,true))}function I(b){return i.getDocument(b.startContainer)}function E(b,h,v){if(h=b._listeners[h])for(var z=0,M=h.length;z<M;++z)h[z].call(b,{target:b,args:v})}function y(b){return new Z(b.parentNode,i.getNodeIndex(b))}function D(b){return new Z(b.parentNode,i.getNodeIndex(b)+1)}function J(b){return i.isCharacterDataNode(b)?b.length:b.childNodes?
                   b.childNodes.length:0}function Q(b,h,v){var z=b.nodeType==11?b.firstChild:b;if(i.isCharacterDataNode(h))v==h.length?i.insertAfter(b,h):h.parentNode.insertBefore(b,v==0?h:i.splitDataNode(h,v));else v>=h.childNodes.length?h.appendChild(b):h.insertBefore(b,h.childNodes[v]);return z}function k(b){for(var h,v,z=I(b.range).createDocumentFragment();v=b.next();){h=b.isPartiallySelectedSubtree();v=v.cloneNode(!h);if(h){h=b.getSubtreeIterator();v.appendChild(k(h));h.detach(true)}if(v.nodeType==10)throw new S("HIERARCHY_REQUEST_ERR");
                   z.appendChild(v)}return z}function p(b,h,v){var z,M;for(v=v||{stop:false};z=b.next();)if(b.isPartiallySelectedSubtree())if(h(z)===false){v.stop=true;return}else{z=b.getSubtreeIterator();p(z,h,v);z.detach(true);if(v.stop)return}else for(z=i.createIterator(z);M=z.next();)if(h(M)===false){v.stop=true;return}}function t(b){for(var h;b.next();)if(b.isPartiallySelectedSubtree()){h=b.getSubtreeIterator();t(h);h.detach(true)}else b.remove()}function x(b){for(var h,v=I(b.range).createDocumentFragment(),z;h=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          b.next();){if(b.isPartiallySelectedSubtree()){h=h.cloneNode(false);z=b.getSubtreeIterator();h.appendChild(x(z));z.detach(true)}else b.remove();if(h.nodeType==10)throw new S("HIERARCHY_REQUEST_ERR");v.appendChild(h)}return v}function B(b,h,v){var z=!!(h&&h.length),M,W=!!v;if(z)M=RegExp("^("+h.join("|")+")$");var ba=[];p(new q(b,false),function(ca){if((!z||M.test(ca.nodeType))&&(!W||v(ca)))ba.push(ca)});return ba}function s(b){return"["+(typeof b.getName=="undefined"?"Range":b.getName())+"("+i.inspectNode(b.startContainer)+
                   ":"+b.startOffset+", "+i.inspectNode(b.endContainer)+":"+b.endOffset+")]"}function q(b,h){this.range=b;this.clonePartiallySelectedTextNodes=h;if(!b.collapsed){this.sc=b.startContainer;this.so=b.startOffset;this.ec=b.endContainer;this.eo=b.endOffset;var v=b.commonAncestorContainer;if(this.sc===this.ec&&i.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=this.sc===v&&!i.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:
                   i.getClosestAncestorIn(this.sc,v,true);this._last=this.ec===v&&!i.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:i.getClosestAncestorIn(this.ec,v,true)}}}function d(b){this.code=this[b];this.codeName=b;this.message="RangeException: "+this.codeName}function f(b,h,v){this.nodes=B(b,h,v);this._next=this.nodes[0];this._position=0}function j(b){return function(h,v){for(var z,M=v?h:h.parentNode;M;){z=M.nodeType;if(i.arrayContains(b,z))return M;M=M.parentNode}return null}}function u(b){for(var h;h=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       b.parentNode;)b=h;return b}function o(b,h){if(C(b,h))throw new d("INVALID_NODE_TYPE_ERR");}function r(b){if(!b.startContainer)throw new S("INVALID_STATE_ERR");}function A(b,h){if(!i.arrayContains(h,b.nodeType))throw new d("INVALID_NODE_TYPE_ERR");}function O(b,h){if(h<0||h>(i.isCharacterDataNode(b)?b.length:b.childNodes.length))throw new S("INDEX_SIZE_ERR");}function R(b,h){if(e(b,true)!==e(h,true))throw new S("WRONG_DOCUMENT_ERR");}function T(b){if(l(b,true))throw new S("NO_MODIFICATION_ALLOWED_ERR");
                   }function F(b,h){if(!b)throw new S(h);}function G(b){if(!e(b.startContainer,true)||!e(b.endContainer,true)||!(b.startOffset<=(i.isCharacterDataNode(b.startContainer)?b.startContainer.length:b.startContainer.childNodes.length))||!(b.endOffset<=(i.isCharacterDataNode(b.endContainer)?b.endContainer.length:b.endContainer.childNodes.length)))throw Error("Range error: Range is no longer valid after DOM mutation ("+b.inspect()+")");}function X(b){b.START_TO_START=P;b.START_TO_END=Y;b.END_TO_END=ka;b.END_TO_START=
                   la;b.NODE_BEFORE=ma;b.NODE_AFTER=na;b.NODE_BEFORE_AND_AFTER=oa;b.NODE_INSIDE=ja}function da(b){X(b);X(b.prototype)}function ga(b,h,v){function z(c,g){return function(n){r(this);A(n,$);A(u(n),ia);n=(c?y:D)(n);(g?M:W)(this,n.node,n.offset)}}function M(c,g,n){var w=c.endContainer,L=c.endOffset;if(g!==c.startContainer||n!==this.startOffset){if(u(g)!=u(w)||i.comparePoints(g,n,w,L)==1){w=g;L=n}h(c,g,n,w,L)}}function W(c,g,n){var w=c.startContainer,L=c.startOffset;if(g!==c.endContainer||n!==this.endOffset){if(u(g)!=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               u(w)||i.comparePoints(g,n,w,L)==-1){w=g;L=n}h(c,w,L,g,n)}}function ba(c,g,n){if(g!==c.startContainer||n!==this.startOffset||g!==c.endContainer||n!==this.endOffset)h(c,g,n,g,n)}function ca(c){return function(){r(this);G(this);var g=this.startContainer,n=this.startOffset,w=this.commonAncestorContainer,L=new q(this,true);if(g!==w){g=i.getClosestAncestorIn(g,w,true);n=D(g);g=n.node;n=n.offset}p(L,T);L.reset();w=c(L);L.detach();h(this,g,n,g,n);return w}}b.prototype={attachListener:function(c,g){this._listeners[c].push(g)},
                   setStart:function(c,g){r(this);o(c,true);O(c,g);M(this,c,g)},setEnd:function(c,g){r(this);o(c,true);O(c,g);W(this,c,g)},setStartBefore:z(true,true),setStartAfter:z(false,true),setEndBefore:z(true,false),setEndAfter:z(false,false),collapse:function(c){r(this);G(this);c?h(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):h(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(c){r(this);o(c,true);h(this,c,0,c,J(c))},selectNode:function(c){r(this);
                   o(c,false);A(c,$);var g=y(c);c=D(c);h(this,g.node,g.offset,c.node,c.offset)},compareBoundaryPoints:function(c,g){r(this);G(this);R(this.startContainer,g.startContainer);var n=c==la||c==P?"start":"end",w=c==Y||c==P?"start":"end";return i.comparePoints(this[n+"Container"],this[n+"Offset"],g[w+"Container"],g[w+"Offset"])},insertNode:function(c){r(this);G(this);A(c,aa);T(this.startContainer);if(i.isAncestorOf(c,this.startContainer,true))throw new S("HIERARCHY_REQUEST_ERR");this.setStartBefore(Q(c,this.startContainer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   this.startOffset))},cloneContents:function(){r(this);G(this);var c,g;if(this.collapsed)return I(this).createDocumentFragment();else{if(this.startContainer===this.endContainer&&i.isCharacterDataNode(this.startContainer)){c=this.startContainer.cloneNode(true);c.data=c.data.slice(this.startOffset,this.endOffset);g=I(this).createDocumentFragment();g.appendChild(c);return g}else{g=new q(this,true);c=k(g);g.detach()}return c}},extractContents:ca(x),deleteContents:ca(t),canSurroundContents:function(){r(this);
                   G(this);T(this.startContainer);T(this.endContainer);var c=new q(this,true),g=c._first&&N(c._first,this)||c._last&&N(c._last,this);c.detach();return!g},surroundContents:function(c){A(c,a);if(!this.canSurroundContents())throw new d("BAD_BOUNDARYPOINTS_ERR");var g=this.extractContents();if(c.hasChildNodes())for(;c.lastChild;)c.removeChild(c.lastChild);Q(c,this.startContainer,this.startOffset);c.appendChild(g);this.selectNode(c)},cloneRange:function(){r(this);G(this);for(var c=new K(I(this)),g=H.length,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           n;g--;){n=H[g];c[n]=this[n]}return c},detach:function(){v(this)},toString:function(){r(this);G(this);var c=this.startContainer;if(c===this.endContainer&&i.isCharacterDataNode(c))return c.nodeType==3||c.nodeType==4?c.data.slice(this.startOffset,this.endOffset):"";else{var g=[];c=new q(this,true);p(c,function(n){if(n.nodeType==3||n.nodeType==4)g.push(n.data)});c.detach();return g.join("")}},compareNode:function(c){r(this);G(this);var g=c.parentNode,n=i.getNodeIndex(c);if(!g)throw new S("NOT_FOUND_ERR");
                   c=this.comparePoint(g,n);g=this.comparePoint(g,n+1);return c<0?g>0?oa:ma:g>0?na:ja},comparePoint:function(c,g){r(this);G(this);F(c,"HIERARCHY_REQUEST_ERR");R(c,this.startContainer);if(i.comparePoints(c,g,this.startContainer,this.startOffset)<0)return-1;else if(i.comparePoints(c,g,this.endContainer,this.endOffset)>0)return 1;return 0},createContextualFragment:function(c){r(this);var g=I(this),n=g.createElement("div");n.innerHTML=c;for(c=g.createDocumentFragment();g=n.firstChild;)c.appendChild(g);return c},
                   intersectsNode:function(c,g){r(this);G(this);F(c,"NOT_FOUND_ERR");if(i.getDocument(c)!==I(this))return false;var n=c.parentNode,w=i.getNodeIndex(c);F(n,"NOT_FOUND_ERR");var L=i.comparePoints(n,w,this.endContainer,this.endOffset);n=i.comparePoints(n,w+1,this.startContainer,this.startOffset);return g?L<=0&&n>=0:L<0&&n>0},isPointInRange:function(c,g){r(this);G(this);F(c,"HIERARCHY_REQUEST_ERR");R(c,this.startContainer);return i.comparePoints(c,g,this.startContainer,this.startOffset)>=0&&i.comparePoints(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            g,this.endContainer,this.endOffset)<=0},intersectsRange:function(c,g){r(this);G(this);if(I(c)!=I(this))throw new S("WRONG_DOCUMENT_ERR");var n=i.comparePoints(this.startContainer,this.startOffset,c.endContainer,c.endOffset),w=i.comparePoints(this.endContainer,this.endOffset,c.startContainer,c.startOffset);return g?n<=0&&w>=0:n<0&&w>0},intersection:function(c){if(this.intersectsRange(c)){var g=i.comparePoints(this.startContainer,this.startOffset,c.startContainer,c.startOffset),n=i.comparePoints(this.endContainer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               this.endOffset,c.endContainer,c.endOffset),w=this.cloneRange();g==-1&&w.setStart(c.startContainer,c.startOffset);n==1&&w.setEnd(c.endContainer,c.endOffset);return w}return null},union:function(c){if(this.intersectsRange(c,true)){var g=this.cloneRange();i.comparePoints(c.startContainer,c.startOffset,this.startContainer,this.startOffset)==-1&&g.setStart(c.startContainer,c.startOffset);i.comparePoints(c.endContainer,c.endOffset,this.endContainer,this.endOffset)==1&&g.setEnd(c.endContainer,c.endOffset);
                   return g}else throw new d("Ranges do not intersect");},containsNode:function(c,g){return g?this.intersectsNode(c,false):this.compareNode(c)==ja},containsNodeContents:function(c){return this.comparePoint(c,0)>=0&&this.comparePoint(c,J(c))<=0},splitBoundaries:function(){r(this);G(this);var c=this.startContainer,g=this.startOffset,n=this.endContainer,w=this.endOffset,L=c===n;i.isCharacterDataNode(n)&&w>0&&w<n.length&&i.splitDataNode(n,w);if(i.isCharacterDataNode(c)&&g>0&&g<c.length){c=i.splitDataNode(c,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          g);if(L){w-=g;n=c}g=0}h(this,c,g,n,w)},normalizeBoundaries:function(){r(this);G(this);var c=this.startContainer,g=this.startOffset,n=this.endContainer,w=this.endOffset,L=function(V){var U=V.nextSibling;if(U&&U.nodeType==V.nodeType){n=V;w=V.length;V.appendData(U.data);U.parentNode.removeChild(U)}},pa=function(V){var U=V.previousSibling;if(U&&U.nodeType==V.nodeType){c=V;g=U.length;V.insertData(0,U.data);U.parentNode.removeChild(U);if(c==n){w+=g;n=c}}},ha=true;if(i.isCharacterDataNode(n))n.length==w&&
                   L(n);else{if(w>0)(ha=n.childNodes[w-1])&&i.isCharacterDataNode(ha)&&L(ha);ha=!this.collapsed}if(ha)if(i.isCharacterDataNode(c))g==0&&pa(c);else{if(g<c.childNodes.length)(L=c.childNodes[g])&&i.isCharacterDataNode(L)&&pa(L)}else{c=n;g=w}h(this,c,g,n,w)},createNodeIterator:function(c,g){r(this);G(this);return new f(this,c,g)},getNodes:function(c,g){r(this);G(this);return B(this,c,g)},collapseToPoint:function(c,g){r(this);G(this);o(c,true);O(c,g);ba(this,c,g)},collapseBefore:function(c){r(this);this.setEndBefore(c);
                   this.collapse(false)},collapseAfter:function(c){r(this);this.setStartAfter(c);this.collapse(true)},getName:function(){return"DomRange"},equals:function(c){return K.rangesEqual(this,c)},inspect:function(){return s(this)}};da(b)}function ea(b){b.collapsed=b.startContainer===b.endContainer&&b.startOffset===b.endOffset;b.commonAncestorContainer=b.collapsed?b.startContainer:i.getCommonAncestor(b.startContainer,b.endContainer)}function fa(b,h,v,z,M){var W=b.startContainer!==h||b.startOffset!==v,ba=b.endContainer!==
                   z||b.endOffset!==M;b.startContainer=h;b.startOffset=v;b.endContainer=z;b.endOffset=M;ea(b);E(b,"boundarychange",{startMoved:W,endMoved:ba})}function K(b){this.startContainer=b;this.startOffset=0;this.endContainer=b;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};ea(this)}m.requireModules(["DomUtil"]);var i=m.dom,Z=i.DomPosition,S=m.DOMException;q.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=
                   this._first},hasNext:function(){return!!this._next},next:function(){var b=this._current=this._next;if(b){this._next=b!==this._last?b.nextSibling:null;if(i.isCharacterDataNode(b)&&this.clonePartiallySelectedTextNodes){if(b===this.ec)(b=b.cloneNode(true)).deleteData(this.eo,b.length-this.eo);if(this._current===this.sc)(b=b.cloneNode(true)).deleteData(0,this.so)}}return b},remove:function(){var b=this._current,h,v;if(i.isCharacterDataNode(b)&&(b===this.sc||b===this.ec)){h=b===this.sc?this.so:0;v=b===
                   this.ec?this.eo:b.length;h!=v&&b.deleteData(h,v-h)}else b.parentNode&&b.parentNode.removeChild(b)},isPartiallySelectedSubtree:function(){return N(this._current,this.range)},getSubtreeIterator:function(){var b;if(this.isSingleCharacterDataNode){b=this.range.cloneRange();b.collapse()}else{b=new K(I(this.range));var h=this._current,v=h,z=0,M=h,W=J(h);if(i.isAncestorOf(h,this.sc,true)){v=this.sc;z=this.so}if(i.isAncestorOf(h,this.ec,true)){M=this.ec;W=this.eo}fa(b,v,z,M,W)}return new q(b,this.clonePartiallySelectedTextNodes)},
                   detach:function(b){b&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};d.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};d.prototype.toString=function(){return this.message};f.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var $=[1,3,4,5,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                7,8,10],ia=[2,9,11],aa=[1,3,4,5,7,8,10,11],a=[1,3,4,5,7,8],e=j([9,11]),l=j([5,6,10,12]),C=j([6,10,12]),H=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],P=0,Y=1,ka=2,la=3,ma=0,na=1,oa=2,ja=3;ga(K,fa,function(b){r(b);b.startContainer=b.startOffset=b.endContainer=b.endOffset=null;b.collapsed=b.commonAncestorContainer=null;E(b,"detach",null);b._listeners=null});K.fromRange=function(b){var h=new K(I(b));fa(h,b.startContainer,b.startOffset,b.endContainer,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        b.endOffset);return h};K.rangeProperties=H;K.RangeIterator=q;K.copyComparisonConstants=da;K.createPrototypeRange=ga;K.inspect=s;K.getRangeDocument=I;K.rangesEqual=function(b,h){return b.startContainer===h.startContainer&&b.startOffset===h.startOffset&&b.endContainer===h.endContainer&&b.endOffset===h.endOffset};K.getEndOffset=J;m.DomRange=K;m.RangeException=d});
rangy.createModule("WrappedRange",function(m){function N(k,p,t,x){var B=k.duplicate();B.collapse(t);var s=B.parentElement();y.isAncestorOf(p,s,true)||(s=p);if(!s.canHaveHTML)return new D(s.parentNode,y.getNodeIndex(s));p=y.getDocument(s).createElement("span");var q,d=t?"StartToStart":"StartToEnd";do{s.insertBefore(p,p.previousSibling);B.moveToElementText(p)}while((q=B.compareEndPoints(d,k))>0&&p.previousSibling);d=p.nextSibling;if(q==-1&&d&&y.isCharacterDataNode(d)){B.setEndPoint(t?"EndToStart":"EndToEnd",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     k);if(/[\r\n]/.test(d.data)){s=B.duplicate();t=s.text.replace(/\r\n/g,"\r").length;for(t=s.moveStart("character",t);s.compareEndPoints("StartToEnd",s)==-1;){t++;s.moveStart("character",1)}}else t=B.text.length;s=new D(d,t)}else{d=(x||!t)&&p.previousSibling;s=(t=(x||t)&&p.nextSibling)&&y.isCharacterDataNode(t)?new D(t,0):d&&y.isCharacterDataNode(d)?new D(d,d.length):new D(s,y.getNodeIndex(p))}p.parentNode.removeChild(p);return s}function I(k,p){var t,x,B=k.offset,s=y.getDocument(k.node),q=s.body.createTextRange(),
                   d=y.isCharacterDataNode(k.node);if(d){t=k.node;x=t.parentNode}else{t=k.node.childNodes;t=B<t.length?t[B]:null;x=k.node}s=s.createElement("span");s.innerHTML="&#feff;";t?x.insertBefore(s,t):x.appendChild(s);q.moveToElementText(s);q.collapse(!p);x.removeChild(s);if(d)q[p?"moveStart":"moveEnd"]("character",B);return q}m.requireModules(["DomUtil","DomRange"]);var E,y=m.dom,D=y.DomPosition,J=m.DomRange;if(m.features.implementsDomRange)(function(){function k(f){for(var j=t.length,u;j--;){u=t[j];f[u]=f.nativeRange[u]}}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      var p,t=J.rangeProperties,x,B;E=function(f){if(!f)throw Error("Range must be specified");this.nativeRange=f;k(this)};J.createPrototypeRange(E,function(f,j,u,o,r){var A=f.endContainer!==o||f.endOffset!=r;if(f.startContainer!==j||f.startOffset!=u||A){f.setEnd(o,r);f.setStart(j,u)}},function(f){f.nativeRange.detach();f.detached=true;for(var j=t.length,u;j--;){u=t[j];f[u]=null}});p=E.prototype;p.selectNode=function(f){this.nativeRange.selectNode(f);k(this)};p.deleteContents=function(){this.nativeRange.deleteContents();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      k(this)};p.extractContents=function(){var f=this.nativeRange.extractContents();k(this);return f};p.cloneContents=function(){return this.nativeRange.cloneContents()};p.surroundContents=function(f){this.nativeRange.surroundContents(f);k(this)};p.collapse=function(f){this.nativeRange.collapse(f);k(this)};p.cloneRange=function(){return new E(this.nativeRange.cloneRange())};p.refresh=function(){k(this)};p.toString=function(){return this.nativeRange.toString()};var s=document.createTextNode("test");y.getBody(document).appendChild(s);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      var q=document.createRange();q.setStart(s,0);q.setEnd(s,0);try{q.setStart(s,1);x=true;p.setStart=function(f,j){this.nativeRange.setStart(f,j);k(this)};p.setEnd=function(f,j){this.nativeRange.setEnd(f,j);k(this)};B=function(f){return function(j){this.nativeRange[f](j);k(this)}}}catch(d){x=false;p.setStart=function(f,j){try{this.nativeRange.setStart(f,j)}catch(u){this.nativeRange.setEnd(f,j);this.nativeRange.setStart(f,j)}k(this)};p.setEnd=function(f,j){try{this.nativeRange.setEnd(f,j)}catch(u){this.nativeRange.setStart(f,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  j);this.nativeRange.setEnd(f,j)}k(this)};B=function(f,j){return function(u){try{this.nativeRange[f](u)}catch(o){this.nativeRange[j](u);this.nativeRange[f](u)}k(this)}}}p.setStartBefore=B("setStartBefore","setEndBefore");p.setStartAfter=B("setStartAfter","setEndAfter");p.setEndBefore=B("setEndBefore","setStartBefore");p.setEndAfter=B("setEndAfter","setStartAfter");q.selectNodeContents(s);p.selectNodeContents=q.startContainer==s&&q.endContainer==s&&q.startOffset==0&&q.endOffset==s.length?function(f){this.nativeRange.selectNodeContents(f);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                      k(this)}:function(f){this.setStart(f,0);this.setEnd(f,J.getEndOffset(f))};q.selectNodeContents(s);q.setEnd(s,3);x=document.createRange();x.selectNodeContents(s);x.setEnd(s,4);x.setStart(s,2);p.compareBoundaryPoints=q.compareBoundaryPoints(q.START_TO_END,x)==-1&q.compareBoundaryPoints(q.END_TO_START,x)==1?function(f,j){j=j.nativeRange||j;if(f==j.START_TO_END)f=j.END_TO_START;else if(f==j.END_TO_START)f=j.START_TO_END;return this.nativeRange.compareBoundaryPoints(f,j)}:function(f,j){return this.nativeRange.compareBoundaryPoints(f,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          j.nativeRange||j)};y.getBody(document).removeChild(s);q.detach();x.detach()})();else if(m.features.implementsTextRange){E=function(k){this.textRange=k;this.refresh()};E.prototype=new J(document);E.prototype.refresh=function(){var k,p,t=this.textRange;k=t.parentElement();var x=t.duplicate();x.collapse(true);p=x.parentElement();x=t.duplicate();x.collapse(false);t=x.parentElement();p=p==t?p:y.getCommonAncestor(p,t);p=p==k?p:y.getCommonAncestor(k,p);if(this.textRange.compareEndPoints("StartToEnd",this.textRange)==
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               0)p=k=N(this.textRange,p,true,true);else{k=N(this.textRange,p,true,false);p=N(this.textRange,p,false,false)}this.setStart(k.node,k.offset);this.setEnd(p.node,p.offset)};E.rangeToTextRange=function(k){if(k.collapsed)return I(new D(k.startContainer,k.startOffset),true);else{var p=I(new D(k.startContainer,k.startOffset),true),t=I(new D(k.endContainer,k.endOffset),false);k=y.getDocument(k.startContainer).body.createTextRange();k.setEndPoint("StartToStart",p);k.setEndPoint("EndToEnd",t);return k}};J.copyComparisonConstants(E);
                   var Q=function(){return this}();if(typeof Q.Range=="undefined")Q.Range=E}E.prototype.getName=function(){return"WrappedRange"};m.WrappedRange=E;m.createNativeRange=function(k){k=k||document;if(m.features.implementsDomRange)return k.createRange();else if(m.features.implementsTextRange)return k.body.createTextRange()};m.createRange=function(k){k=k||document;return new E(m.createNativeRange(k))};m.createRangyRange=function(k){k=k||document;return new J(k)};m.createIframeRange=function(k){return m.createRange(y.getIframeDocument(k))};
                   m.createIframeRangyRange=function(k){return m.createRangyRange(y.getIframeDocument(k))};m.addCreateMissingNativeApiListener(function(k){k=k.document;if(typeof k.createRange=="undefined")k.createRange=function(){return m.createRange(this)};k=k=null})});
rangy.createModule("WrappedSelection",function(m,N){function I(a){return(a||window).getSelection()}function E(a){return(a||window).document.selection}function y(a,e,l){var C=l?"end":"start";l=l?"start":"end";a.anchorNode=e[C+"Container"];a.anchorOffset=e[C+"Offset"];a.focusNode=e[l+"Container"];a.focusOffset=e[l+"Offset"]}function D(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=true;a._ranges.length=0}function J(a){var e;if(a instanceof j){e=a._selectionNativeRange;
                   if(!e){e=m.createNativeRange(d.getDocument(a.startContainer));e.setEnd(a.endContainer,a.endOffset);e.setStart(a.startContainer,a.startOffset);a._selectionNativeRange=e;a.attachListener("detach",function(){this._selectionNativeRange=null})}}else if(a instanceof u)e=a.nativeRange;else if(window.Range&&a instanceof Range)e=a;return e}function Q(a){var e=a.getNodes(),l;a:if(!e.length||e[0].nodeType!=1)l=false;else{l=1;for(var C=e.length;l<C;++l)if(!d.isAncestorOf(e[0],e[l])){l=false;break a}l=true}if(!l)throw Error("getSingleElementFromRange: range "+
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        a.inspect()+" did not consist of a single element");return e[0]}function k(a,e){var l=new u(e);a._ranges=[l];y(a,l,false);a.rangeCount=1;a.isCollapsed=l.collapsed}function p(a){a._ranges.length=0;if(a.docSelection.type=="None")D(a);else{var e=a.docSelection.createRange();if(e&&typeof e.text!="undefined")k(a,e);else{a.rangeCount=e.length;for(var l,C=d.getDocument(e.item(0)),H=0;H<a.rangeCount;++H){l=m.createRange(C);l.selectNode(e.item(H));a._ranges.push(l)}a.isCollapsed=a.rangeCount==1&&a._ranges[0].collapsed;
                   y(a,a._ranges[a.rangeCount-1],false)}}}function t(a,e){var l=a.docSelection.createRange(),C=Q(e),H=d.getDocument(l.item(0));H=d.getBody(H).createControlRange();for(var P=0,Y=l.length;P<Y;++P)H.add(l.item(P));try{H.add(C)}catch(ka){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");}H.select();p(a)}function x(a,e){this.nativeSelection=a;this.docSelection=e;this._ranges=[];this.refresh()}function B(a,e){var l=d.getDocument(e[0].startContainer);
                   l=d.getBody(l).createControlRange();for(var C=0,H;C<rangeCount;++C){H=Q(e[C]);try{l.add(H)}catch(P){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)");}}l.select();p(a)}function s(a,e){if(a.anchorNode&&d.getDocument(a.anchorNode)!==d.getDocument(e))throw new o("WRONG_DOCUMENT_ERR");}function q(a){var e=[],l=new r(a.anchorNode,a.anchorOffset),C=new r(a.focusNode,a.focusOffset),H=typeof a.getName=="function"?a.getName():
                   "Selection";if(typeof a.rangeCount!="undefined")for(var P=0,Y=a.rangeCount;P<Y;++P)e[P]=j.inspect(a.getRangeAt(P));return"["+H+"(Ranges: "+e.join(", ")+")(anchor: "+l.inspect()+", focus: "+C.inspect()+"]"}m.requireModules(["DomUtil","DomRange","WrappedRange"]);m.config.checkSelectionRanges=true;var d=m.dom,f=m.util,j=m.DomRange,u=m.WrappedRange,o=m.DOMException,r=d.DomPosition,A,O,R=m.util.isHostMethod(window,"getSelection"),T=m.util.isHostObject(document,"selection");if(R)A=I;else if(T)A=E;else N.fail("No means of obtaining a selection object");
                   m.getNativeSelection=A;var F=A();R=m.createNativeRange(document);var G=d.getBody(document),X=f.areHostObjects(F,f.areHostProperties(F,["anchorOffset","focusOffset"]));m.features.selectionHasAnchorAndFocus=X;var da=f.isHostMethod(F,"extend");m.features.selectionHasExtend=da;var ga=typeof F.rangeCount=="number";m.features.selectionHasRangeCount=ga;var ea=false,fa=true;f.areHostMethods(F,["addRange","getRangeAt","removeAllRanges"])&&typeof F.rangeCount=="number"&&m.features.implementsDomRange&&function(){var a=
                   G.appendChild(document.createTextNode("One")),e=G.appendChild(document.createTextNode("Two")),l=m.createNativeRange(document);l.selectNodeContents(a);var C=m.createNativeRange(document);C.selectNodeContents(e);F.removeAllRanges();F.addRange(l);F.addRange(C);ea=F.rangeCount==2;F.removeAllRanges();a.parentNode.removeChild(a);e.parentNode.removeChild(e);a=document.createElement("p");a.contentEditable=false;e=a.appendChild(document.createTextNode("test"));G.appendChild(a);l=m.createRange();l.collapseToPoint(e,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                1);F.addRange(l.nativeRange);fa=F.rangeCount==1;F.removeAllRanges();G.removeChild(a)}();m.features.selectionSupportsMultipleRanges=ea;m.features.collapsedNonEditableSelectionsSupported=fa;var K=false,i;if(G&&f.isHostMethod(G,"createControlRange")){i=G.createControlRange();if(f.areHostProperties(i,["item","add"]))K=true}m.features.implementsControlRange=K;O=X?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:
                   false};var Z;if(f.isHostMethod(F,"getRangeAt"))Z=function(a,e){try{return a.getRangeAt(e)}catch(l){return null}};else if(X)Z=function(a){var e=d.getDocument(a.anchorNode);e=m.createRange(e);e.setStart(a.anchorNode,a.anchorOffset);e.setEnd(a.focusNode,a.focusOffset);if(e.collapsed!==this.isCollapsed){e.setStart(a.focusNode,a.focusOffset);e.setEnd(a.anchorNode,a.anchorOffset)}return e};m.getSelection=function(a){a=a||window;var e=a._rangySelection,l=A(a),C=T?E(a):null;if(e){e.nativeSelection=l;e.docSelection=
                   C;e.refresh()}else{e=new x(l,C);a._rangySelection=e}return e};m.getIframeSelection=function(a){return m.getSelection(d.getIframeWindow(a))};i=x.prototype;if(X&&f.areHostMethods(F,["removeAllRanges","addRange"])){i.removeAllRanges=function(){this.nativeSelection.removeAllRanges();D(this)};var S=function(a,e){var l=j.getRangeDocument(e);l=m.createRange(l);l.collapseToPoint(e.endContainer,e.endOffset);a.nativeSelection.addRange(J(l));a.nativeSelection.extend(e.startContainer,e.startOffset);a.refresh()};
                   i.addRange=ga?function(a,e){if(K&&T&&this.docSelection.type=="Control")t(this,a);else if(e&&da)S(this,a);else{var l;if(ea)l=this.rangeCount;else{this.removeAllRanges();l=0}this.nativeSelection.addRange(J(a));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==l+1){if(m.config.checkSelectionRanges)if((l=Z(this.nativeSelection,this.rangeCount-1))&&!j.rangesEqual(l,a))a=new u(l);this._ranges[this.rangeCount-1]=a;y(this,a,aa(this.nativeSelection));this.isCollapsed=O(this)}else this.refresh()}}:
                   function(a,e){if(e&&da)S(this,a);else{this.nativeSelection.addRange(J(a));this.refresh()}};i.setRanges=function(a){if(K&&a.length>1)B(this,a);else{this.removeAllRanges();for(var e=0,l=a.length;e<l;++e)this.addRange(a[e])}}}else if(f.isHostMethod(F,"empty")&&f.isHostMethod(R,"select")&&K&&T){i.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a;if(this.anchorNode)a=d.getDocument(this.anchorNode);else if(this.docSelection.type=="Control"){var e=this.docSelection.createRange();
                   if(e.length)a=d.getDocument(e.item(0)).body.createTextRange()}if(a){a.body.createTextRange().select();this.docSelection.empty()}}}catch(l){}D(this)};i.addRange=function(a){if(this.docSelection.type=="Control")t(this,a);else{u.rangeToTextRange(a).select();this._ranges[0]=a;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;y(this,a,false)}};i.setRanges=function(a){this.removeAllRanges();var e=a.length;if(e>1)B(this,a);else e&&this.addRange(a[0])}}else{N.fail("No means of selecting a Range or TextRange was found");
                   return false}i.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new o("INDEX_SIZE_ERR");else return this._ranges[a]};var $;if(f.isHostMethod(F,"getRangeAt")&&typeof F.rangeCount=="number")$=function(a){if(K&&T&&a.docSelection.type=="Control")p(a);else{a._ranges.length=a.rangeCount=a.nativeSelection.rangeCount;if(a.rangeCount){for(var e=0,l=a.rangeCount;e<l;++e)a._ranges[e]=new m.WrappedRange(a.nativeSelection.getRangeAt(e));y(a,a._ranges[a.rangeCount-1],aa(a.nativeSelection));a.isCollapsed=
                   O(a)}else D(a)}};else if(X&&typeof F.isCollapsed=="boolean"&&typeof R.collapsed=="boolean"&&m.features.implementsDomRange)$=function(a){var e;e=a.nativeSelection;if(e.anchorNode){e=Z(e,0);a._ranges=[e];a.rangeCount=1;e=a.nativeSelection;a.anchorNode=e.anchorNode;a.anchorOffset=e.anchorOffset;a.focusNode=e.focusNode;a.focusOffset=e.focusOffset;a.isCollapsed=O(a)}else D(a)};else if(f.isHostMethod(F,"createRange")&&T)$=function(a){var e=a.docSelection.createRange();if(a.docSelection.type=="Control")p(a);
                   else e&&typeof e.text!="undefined"?k(a,e):D(a)};else{N.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}i.refresh=function(a){var e=a?this._ranges.slice(0):null;$(this);if(a){a=e.length;if(a!=this._ranges.length)return false;for(;a--;)if(!j.rangesEqual(e[a],this._ranges[a]))return false;return true}};var ia=function(a,e){var l=a.getAllRanges(),C=false;a.removeAllRanges();for(var H=0,P=l.length;H<P;++H)if(C||e!==l[H])a.addRange(l[H]);else C=true;a.rangeCount||
                   D(a)};i.removeRange=K?function(a){if(this.docSelection.type=="Control"){var e=this.docSelection.createRange();a=Q(a);var l=d.getDocument(e.item(0));l=d.getBody(l).createControlRange();for(var C,H=false,P=0,Y=e.length;P<Y;++P){C=e.item(P);if(C!==a||H)l.add(e.item(P));else H=true}l.select();p(this)}else ia(this,a)}:function(a){ia(this,a)};var aa;if(X&&m.features.implementsDomRange){aa=function(a){var e=false;if(a.anchorNode)e=d.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1;
                   return e};i.isBackwards=function(){return aa(this)}}else aa=i.isBackwards=function(){return false};i.toString=function(){for(var a=[],e=0,l=this.rangeCount;e<l;++e)a[e]=""+this._ranges[e];return a.join("")};i.collapse=function(a,e){s(this,a);var l=m.createRange(d.getDocument(a));l.collapseToPoint(a,e);this.removeAllRanges();this.addRange(l);this.isCollapsed=true};i.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new o("INVALID_STATE_ERR");
                   };i.collapseToEnd=function(){if(this.rangeCount){var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new o("INVALID_STATE_ERR");};i.selectAllChildren=function(a){s(this,a);var e=m.createRange(d.getDocument(a));e.selectNodeContents(a);this.removeAllRanges();this.addRange(e)};i.deleteFromDocument=function(){if(K&&T&&this.docSelection.type=="Control"){for(var a=this.docSelection.createRange(),e;a.length;){e=a.item(0);a.remove(e);e.parentNode.removeChild(e)}this.refresh()}else if(this.rangeCount){a=
                   this.getAllRanges();this.removeAllRanges();e=0;for(var l=a.length;e<l;++e)a[e].deleteContents();this.addRange(a[l-1])}};i.getAllRanges=function(){return this._ranges.slice(0)};i.setSingleRange=function(a){this.setRanges([a])};i.containsNode=function(a,e){for(var l=0,C=this._ranges.length;l<C;++l)if(this._ranges[l].containsNode(a,e))return true;return false};i.getName=function(){return"WrappedSelection"};i.inspect=function(){return q(this)};i.detach=function(){if(this.anchorNode)d.getWindow(this.anchorNode)._rangySelection=
                   null};x.inspect=q;m.Selection=x;m.addCreateMissingNativeApiListener(function(a){if(typeof a.getSelection=="undefined")a.getSelection=function(){return m.getSelection(this)};a=null})});
/*
 CSS Class Applier module for Rangy.
 Adds, removes and toggles CSS classes on Ranges and Selections
 
 Part of Rangy, a cross-browser JavaScript range and selection library
 http://code.google.com/p/rangy/
 
 Depends on Rangy core.
 
 Copyright 2011, Tim Down
 Licensed under the MIT license.
 Version: 1.2
 Build date: 25 April 2011
 */
rangy.createModule("CssClassApplier",function(h){function s(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function n(a,b){return a.className&&RegExp("(?:^|\\s)"+b+"(?:\\s|$)").test(a.className)}function t(a,b){if(a.className)n(a,b)||(a.className+=" "+b);else a.className=b}function o(a){return a.className.split(/\s+/).sort().join(" ")}function u(a,b){return o(a)==o(b)}function v(a){for(var b=a.parentNode;a.hasChildNodes();)b.insertBefore(a.firstChild,a);b.removeChild(a)}function w(a,b){if(a.attributes.length!=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     b.attributes.length)return false;for(var c=0,d=a.attributes.length,e,f;c<d;++c){e=a.attributes[c];f=e.name;if(f!="class"){f=b.attributes.getNamedItem(f);if(e.specified!=f.specified)return false;if(e.specified&&e.nodeValue!==f.nodeValue)return false}}return true}function x(a){for(var b=0,c=a.attributes.length;b<c;++b)if(a.attributes[b].specified&&a.attributes[b].name!="class")return true;return false}function y(a,b){if(g.isCharacterDataNode(a))return b==0?!!a.previousSibling:b==a.length?!!a.nextSibling:
                   true;return b>0&&b<a.childNodes.length}function l(a,b,c){var d;if(g.isCharacterDataNode(b))if(c==0){c=g.getNodeIndex(b);b=b.parentNode}else if(c==b.length){c=g.getNodeIndex(b)+1;b=b.parentNode}else d=g.splitDataNode(b,c);if(!d){d=b.cloneNode(false);d.id&&d.removeAttribute("id");for(var e;e=b.childNodes[c];)d.appendChild(e);g.insertAfter(d,b)}return b==a?d:l(a,d.parentNode,g.getNodeIndex(d))}function z(a,b){var c=a.nodeType==3,d=c?a.parentNode:a,e=b?"nextSibling":"previousSibling";if(c){if((c=a[e])&&
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 c.nodeType==3)return c}else if((c=d[e])&&a.tagName==c.tagName&&u(a,c)&&w(a,c))return c[b?"firstChild":"lastChild"];return null}function p(a){this.firstTextNode=(this.isElementMerge=a.nodeType==1)?a.lastChild:a;if(this.isElementMerge)this.sortedCssClasses=o(a);this.textNodes=[this.firstTextNode]}function m(a,b,c){this.cssClass=a;this.normalize=b;this.applyToAnyTagName=false;a=typeof c;if(a=="string")if(c=="*")this.applyToAnyTagName=true;else this.tagNames=s(c.toLowerCase()).split(/\s*,\s*/);else if(a==
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        "object"&&typeof c.length=="number"){this.tagNames=[];a=0;for(b=c.length;a<b;++a)if(c[a]=="*")this.applyToAnyTagName=true;else this.tagNames.push(c[a].toLowerCase())}else this.tagNames=[q]}h.requireModules(["WrappedSelection","WrappedRange"]);var g=h.dom,q="span",A=function(){function a(b,c,d){return c&&d?" ":""}return function(b,c){if(b.className)b.className=b.className.replace(RegExp("(?:^|\\s)"+c+"(?:\\s|$)"),a)}}();p.prototype={doMerge:function(){for(var a=[],b,c,d=0,e=this.textNodes.length;d<
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   e;++d){b=this.textNodes[d];c=b.parentNode;a[d]=b.data;if(d){c.removeChild(b);c.hasChildNodes()||c.parentNode.removeChild(c)}}return this.firstTextNode.data=a=a.join("")},getLength:function(){for(var a=this.textNodes.length,b=0;a--;)b+=this.textNodes[a].length;return b},toString:function(){for(var a=[],b=0,c=this.textNodes.length;b<c;++b)a[b]="'"+this.textNodes[b].data+"'";return"[Merge("+a.join(",")+")]"}};m.prototype={getAncestorWithClass:function(a){for(a=a.parentNode;a;){if(a.nodeType==1&&g.arrayContains(this.tagNames,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    a.tagName.toLowerCase())&&n(a,this.cssClass))return a;a=a.parentNode}return false},postApply:function(a,b){for(var c=a[0],d=a[a.length-1],e=[],f,j=c,B=d,C=0,D=d.length,k,E,i=0,r=a.length;i<r;++i){k=a[i];if(E=z(k,false)){if(!f){f=new p(E);e.push(f)}f.textNodes.push(k);if(k===c){j=f.firstTextNode;C=j.length}if(k===d){B=f.firstTextNode;D=f.getLength()}}else f=null}if(c=z(d,true)){if(!f){f=new p(d);e.push(f)}f.textNodes.push(c)}if(e.length){i=0;for(r=e.length;i<r;++i)e[i].doMerge();b.setStart(j,C);b.setEnd(B,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                D)}},createContainer:function(a){a=a.createElement(q);a.className=this.cssClass;return a},applyToTextNode:function(a){var b=a.parentNode;if(b.childNodes.length==1&&g.arrayContains(this.tagNames,b.tagName.toLowerCase()))t(b,this.cssClass);else{b=this.createContainer(g.getDocument(a));a.parentNode.insertBefore(b,a);b.appendChild(a)}},isRemovable:function(a){return a.tagName.toLowerCase()==q&&s(a.className)==this.cssClass&&!x(a)},undoToTextNode:function(a,b,c){if(!b.containsNode(c)){a=b.cloneRange();
                   a.selectNode(c);if(a.isPointInRange(b.endContainer,b.endOffset)&&y(b.endContainer,b.endOffset)){l(c,b.endContainer,b.endOffset);b.setEndAfter(c)}if(a.isPointInRange(b.startContainer,b.startOffset)&&y(b.startContainer,b.startOffset))c=l(c,b.startContainer,b.startOffset)}this.isRemovable(c)?v(c):A(c,this.cssClass)},applyToRange:function(a){a.splitBoundaries();var b=a.getNodes([3]);if(b.length){for(var c,d=0,e=b.length;d<e;++d){c=b[d];this.getAncestorWithClass(c)||this.applyToTextNode(c)}a.setStart(b[0],
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        0);c=b[b.length-1];a.setEnd(c,c.length);this.normalize&&this.postApply(b,a)}},applyToSelection:function(a){a=a||window;a=h.getSelection(a);var b,c=a.getAllRanges();a.removeAllRanges();for(var d=c.length;d--;){b=c[d];this.applyToRange(b);a.addRange(b)}},undoToRange:function(a){a.splitBoundaries();var b=a.getNodes([3]),c,d,e=b[b.length-1];if(b.length){for(var f=0,j=b.length;f<j;++f){c=b[f];(d=this.getAncestorWithClass(c))&&this.undoToTextNode(c,a,d);a.setStart(b[0],0);a.setEnd(e,e.length)}this.normalize&&
                   this.postApply(b,a)}},undoToSelection:function(a){a=a||window;a=h.getSelection(a);var b=a.getAllRanges(),c;a.removeAllRanges();for(var d=0,e=b.length;d<e;++d){c=b[d];this.undoToRange(c);a.addRange(c)}},getTextSelectedByRange:function(a,b){var c=b.cloneRange();c.selectNodeContents(a);var d=c.intersection(b);d=d?d.toString():"";c.detach();return d},isAppliedToRange:function(a){for(var b=a.getNodes([3]),c=0,d=b.length,e;c<d;++c){e=this.getTextSelectedByRange(b[c],a);if(e!=""&&!this.getAncestorWithClass(b[c]))return false}return true},
                   isAppliedToSelection:function(a){a=a||window;a=h.getSelection(a).getAllRanges();for(var b=a.length;b--;)if(!this.isAppliedToRange(a[b]))return false;return true},toggleRange:function(a){this.isAppliedToRange(a)?this.undoToRange(a):this.applyToRange(a)},toggleSelection:function(a){this.isAppliedToSelection(a)?this.undoToSelection(a):this.applyToSelection(a)},detach:function(){}};m.util={hasClass:n,addClass:t,removeClass:A,hasSameClasses:u,replaceWithOwnChildren:v,elementsHaveSameNonClassAttributes:w,
                   elementHasNonClassAttributes:x,splitNodeAt:l};h.CssClassApplier=m;h.createCssClassApplier=function(a,b,c){return new m(a,b,c)}});